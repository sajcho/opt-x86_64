# Description:	Text shaping library
# URL:		https://freedesktop.org/wiki/Software/HarfBuzz
# Maintainer:	sajcho, saux dot aarch64 at gmail dot com
# Depends on:	cairo gobject-introspection graphite2 icu

name=harfbuzz
version=6.0.0
release=2
source=(https://github.com/${name}/${name}/releases/download/${version}/${name}-${version}.tar.xz)

build() {
	cd ${name}-${version}

	# fix - we have gcc-13.0.1 in the system
	sed '/hb-subset.h/a #include <cstdio>' \
		-i $SRC/${name}-${version}/test/threads/hb-subset-threads.cc
	sed '/cstdio/a #include <cstdlib>' \
		-i $SRC/${name}-${version}/test/threads/hb-subset-threads.cc

	build-meson \
		-Dglib=enabled \
		-Dgobject=enabled \
		-Dintrospection=enabled \
		-Dicu=enabled \
		-Dfreetype=enabled \
		-Dcairo=enabled \
		-Dgraphite=enabled \
		-Dbenchmark=disabled \
		-Ddocs=disabled \
		. build

	meson compile ${JOBS:+-j ${JOBS}} -v -C build

	DESTDIR=$PKG meson install --no-rebuild -C build
}
