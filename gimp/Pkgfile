# Description:	GNU Image Manipulation Program
# URL:		https://www.gimp.org/
# Maintainer:	sajcho, saux dot aarch64 at gmail dot com
# Depends on:	dbus-glib desktop-file-utils gegl glib-networking gtk2 libexif libmypaint libxmu mypaint-brushes poppler-data

name=gimp
version=2.10.24
release=1
source=(https://download.gimp.org/mirror/pub/${name}/v${version%.*}/${name}-${version}.tar.bz2 \
	0001-no-check-update.patch)

build() {
	cd ${name}-${version}

	patch -Np1 -i $SRC/0001-no-check-update.patch
	sed -i -e '/$(helpbrowser)/d' plug-ins/Makefile.in

	export CFLAGS+=" -Wno-deprecated-declarations"

	./configure \
		--prefix=/usr \
		--sysconfdir=/etc \
		--libexecdir=/usr/bin \
		--enable-mp \
		--enable-gimp-console \
		--disable-static \
		--disable-dependency-tracking \
		--disable-python \
		--disable-nls \
		--disable-check-update \
		--with-jpeg2000=yes \
		--with-libheif=yes \
		--with-webp=yes \
		--without-webkit \
		--without-aa

	make

	#make check

	make DESTDIR=$PKG install

	mv $PKG/usr/share/man/man1/gimp-console{-${version%.*}.1,.1}

	rm -r $PKG/usr/share/{gtk-doc,locale}
}
