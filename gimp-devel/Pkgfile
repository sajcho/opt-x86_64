# Description:	GNU Image Manipulation Program - devel version
# URL:		https://www.gimp.org/
# Maintainer:	sajcho, saux dot aarch64 at gmail dot com
# Depends on:	appstream-glib dbus-glib desktop-file-utils gegl imagemagick libexif libgudev libmypaint libxmu mypaint-brushes poppler-data poppler-glib

name=gimp-devel
_realname=gimp
version=2.99.14
release=1
source=(https://download.gimp.org/pub/gimp/v${version%.*}/${_realname}-${version}.tar.xz)

build() {
	cd ${_realname}-${version}

	CFLAGS+=" -ffat-lto-objects"
	CXXFLAGS+=" -ffat-lto-objects"

	build-meson \
		-Djavascript=false \
		-Dlua=false \
		-Dprint=false \
		-Dalsa=disabled \
		-Dvala-plugins=disabled \
		-Dcheck-update=no \
		-Dbug-report-url="https://github.com/sajcho/" \
		. build

	meson compile ${JOBS:+-j ${JOBS}} -v -C build

	DESTDIR=$PKG meson install --no-rebuild -C build

	rm -r $PKG/usr/share/{locale,metainfo}

	find $PKG/usr/share -type f -name '*.desktop' \
		-exec sed -r -e '/\[.+\]=/d' -e '/#/d' -i {} \;
}
