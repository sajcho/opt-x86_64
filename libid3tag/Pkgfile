# Description:	MAD ID3 tagger for MP3 audio files
# URL:		http://www.underbit.com/products/mad/
# Maintainer:	sajcho, saux dot aarch64 at gmail dot com
# Depends on:	gperf zlib

name=libid3tag
version=0.15.1b
release=0
source=(https://downloads.sourceforge.net/project/mad/${name}/${version}/${name}-${version}.tar.gz \
	10_utf16.diff \
	11_unknown_encoding.diff \
	CVE-2008-2109.patch \
	libid3tag-gperf.patch)

build() {
	cd ${name}-${version}

	patch -Np1 -i $SRC/10_utf16.diff
	patch -Np1 -i $SRC/11_unknown_encoding.diff
	patch -Np0 -i $SRC/CVE-2008-2109.patch
	patch -Np1 -i $SRC/libid3tag-gperf.patch

	rm compat.c frametype.c # regenerate them from gperf sources
	# adding missing files for autoreconf
	touch AUTHORS ChangeLog NEWS

	autoreconf -fiv

	./configure \
		--prefix=/usr

	make

	make DESTDIR=$PKG install

	install -d $PKG/usr/lib/pkgconfig
	cat > $PKG/usr/lib/pkgconfig/id3tag.pc <<EOF
prefix=/usr
exec_prefix=/usr/bin
libdir=/usr/lib
includedir=/usr/include

Name: id3tag
Description: ID3 tag manipulation library
Requires:
Version: ${version}
Libs: -lid3tag
Cflags:
EOF
}
